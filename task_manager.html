<!doctype html><html lang="ja"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1" name="viewport"><title>Material Task Manager v2.31</title><link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"><style>body{background-color:#f5f5f5;padding-bottom:80px;color:#424242;font-size:16px;line-height:1.5}.nav-wrapper{padding:0 20px}.font-bold{font-weight:700}.multiline-truncate{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;overflow:hidden;text-overflow:ellipsis;white-space:normal;word-wrap:break-word;line-height:1.4;max-height:4.2em}.tabs .tab a{color:#009688;font-weight:700;font-size:1rem}.tabs .tab a.active,.tabs .tab a:hover{color:#00796b}.tabs .indicator{background-color:#e91e63}.tab-content{margin-top:20px}.sticky-header-wrapper{position:sticky;top:0;z-index:100;background-color:#f5f5f5;padding-top:15px;padding-bottom:5px;margin-bottom:0;box-shadow:0 4px 5px -2px rgba(0,0,0,.1)}.task-row{background:#fff;border-bottom:1px solid #e0e0e0;padding:12px 20px;display:flex;align-items:center;cursor:pointer;transition:background-color .2s ease;position:relative;font-size:1rem}.task-row:hover{background-color:#f9f9f9}.task-row:last-child{border-bottom:none;border-bottom-left-radius:4px;border-bottom-right-radius:4px}.task-row.completed-task{background-color:#fafafa;color:#9e9e9e}.task-row.completed-task .col-category,.task-row.completed-task .col-name{color:#bdbdbd;text-decoration:line-through}.task-row.completed-task .badge-common{background-color:#e0e0e0!important;color:#9e9e9e!important;box-shadow:none}.highlight-task{background-color:#fff9c4!important;transition:none}.badge-common{display:inline-block;padding:4px 12px;border-radius:12px;color:#fff;font-size:.85rem;font-weight:400;line-height:1.4;white-space:nowrap;text-align:center;vertical-align:middle}.category-badge{max-width:100%;overflow:hidden;text-overflow:ellipsis;font-size:.85rem}.status-chip{display:inline-block;padding:4px 12px;border-radius:12px;color:#fff;font-size:.85rem;font-weight:400;line-height:1.4;white-space:nowrap;text-align:center;vertical-align:middle;width:100%;cursor:pointer;transition:opacity .2s;box-shadow:0 1px 2px rgba(0,0,0,.1)}.status-chip:hover{opacity:.9;box-shadow:0 2px 4px rgba(0,0,0,.15)}.date-type-badge{padding:2px 12px;border-radius:10px;font-size:.8rem;margin-top:4px;margin-left:0;cursor:pointer;transition:opacity .2s;display:inline-block}.date-type-badge:hover{opacity:.8;box-shadow:0 1px 3px rgba(0,0,0,.2)}.type-confirmed{background-color:#1565c0;color:#fff}.type-planned{background-color:#616161;color:#fff}.sortable-ghost{opacity:.4;background-color:#b2dfdb}.sortable-drag{cursor:grabbing}.col-check{width:40px;text-align:center;flex-shrink:0;margin-right:10px}.col-priority{width:50px;font-weight:700;color:#e91e63;text-align:center;margin-right:10px;flex-shrink:0;font-size:1rem;cursor:pointer;transition:transform .1s}.col-priority:hover{transform:scale(1.2);color:#c2185b}.col-category{width:110px;margin-right:15px;flex-shrink:0;font-size:1rem}.col-name{width:25%;font-weight:700;margin-right:15px;flex-shrink:0;font-size:1rem}.col-summary{flex:1;color:#757575;font-size:1rem;margin-right:15px;min-width:0}.col-status{width:100px;text-align:center;margin-right:15px;flex-shrink:0}.col-date{width:110px;text-align:right;color:#616161;font-size:1rem;flex-shrink:0;line-height:1.5}.col-action{width:40px;text-align:center;flex-shrink:0}.list-header{display:flex;padding:12px 20px;color:#757575;font-size:1rem;font-weight:700;background-color:#fff;border-radius:4px 4px 0 0;margin-bottom:0;border-bottom:1px solid #e0e0e0;position:sticky;z-index:90;box-shadow:0 2px 2px -2px rgba(0,0,0,.1)}.btn-complete{color:#e0e0e0;cursor:pointer;transition:color .2s;font-size:24px}.btn-complete:hover{color:#66bb6a}.modal .modal-content{padding-bottom:0}.modal-header-actions{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.link-row{display:flex;align-items:center;gap:10px;margin-bottom:5px}.link-icon-btn{cursor:pointer;color:#26a69a}.filter-area{background-color:#fff;padding:15px 20px 5px 20px;border-radius:4px;margin-bottom:15px;display:flex;align-items:center;gap:15px;flex-wrap:wrap;box-shadow:0 1px 3px rgba(0,0,0,.1)}.filter-area .input-field{margin-top:0;margin-bottom:10px;min-width:140px}.filter-search{flex:1;min-width:200px}.filter-msg{font-size:.8rem;color:#e91e63;width:100%;text-align:right;display:none;margin-bottom:10px}.bulk-action-bar{position:fixed;bottom:0;left:0;width:100%;background-color:#37474f;color:#fff;padding:10px 20px;z-index:1000;display:none;box-shadow:0 -2px 5px rgba(0,0,0,.2)}.bulk-content{display:flex;align-items:center;justify-content:space-between;max-width:1200px;margin:0 auto}.info-section h6{font-weight:700;border-left:4px solid #26a69a;padding-left:10px;margin-top:20px}.changelog-date{color:#757575;font-size:.8rem;margin-right:10px}.date-input-wrapper{position:relative}.clear-date-btn{position:absolute;right:0;top:15px;cursor:pointer;color:#9e9e9e;z-index:10}.clear-date-btn:hover{color:#ef5350}.inline-date-input{border:none!important;box-shadow:none!important;background-color:transparent!important;height:auto!important;width:100%!important;padding:0!important;margin:0!important;text-align:right;font-size:1rem!important;color:inherit;cursor:pointer;font-family:inherit;cursor:pointer}.inline-date-input::-webkit-calendar-picker-indicator{cursor:pointer;opacity:.6;margin-left:5px}.inline-date-input::-webkit-calendar-picker-indicator:hover{opacity:1}.date-input-container{display:flex;align-items:center;justify-content:flex-end;position:relative;width:100%}.date-clear-btn{cursor:pointer;color:#bdbdbd;margin-left:2px;font-size:1.2rem;transition:color .2s}.date-clear-btn:hover{color:#ef5350}.date-input-container:hover .date-clear-btn{opacity:1}.date-placeholder{position:relative;display:inline-block;cursor:pointer;width:24px;height:24px;vertical-align:middle}.date-placeholder i{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:1.2rem}.date-placeholder:hover i{color:#26a69a!important}.hidden-date-trigger{position:absolute;top:0;left:0;width:100%!important;height:100%!important;opacity:0;cursor:pointer;padding:0;margin:0;border:none}.dropdown-content{min-width:180px!important;z-index:2000!important}.dropdown-content li>a{font-size:.9rem;color:#424242;padding:10px 16px;display:flex;align-items:center}.dropdown-content li>a>i{margin-right:12px;font-size:1.2rem;color:#757575}.empty-state{text-align:center;padding:40px 20px;color:#9e9e9e}.empty-state i{font-size:4rem;margin-bottom:10px;color:#e0e0e0}.search-highlight{background-color:#fff59d;color:#000;font-weight:700;padding:0 2px;border-radius:2px}.toast-action-btn{color:#ffeb3b;font-weight:700;margin-left:15px;cursor:pointer;text-transform:uppercase}</style></head><body><nav class="lighten-1 teal"><div class="nav-wrapper"><a class="brand-logo truncate" href="#"><i class="material-icons">assignment</i>Task Board v2.31</a><ul class="right hide-on-med-and-down" id="nav-mobile"><li><a class="modal-trigger" href="#infoModal"><i class="material-icons left">help_outline</i>Help</a></li><li><a onclick="exportHTML()"><i class="material-icons left">save</i>Save Tool</a></li><li><a class="dropdown-trigger" href="#" data-target="dropdown-json"><i class="material-icons left">code</i>JSON</a></li><li><a class="dropdown-trigger" href="#" data-target="dropdown-excel"><i class="material-icons left">grid_on</i>Excel</a></li><li><a onclick="resetToSaved()"><i class="material-icons left">restore</i>Reset</a></li></ul><ul class="dropdown-content" id="dropdown-json"><li><a onclick="exportJSON()"><i class="material-icons">file_download</i>JSON保存</a></li><li><a onclick='document.getElementById("jsonInput").click()'><i class="material-icons">file_upload</i>JSON読込</a></li></ul><ul class="dropdown-content" id="dropdown-excel"><li><a onclick="exportExcel()"><i class="material-icons">file_download</i>Excel出力</a></li><li><a onclick='document.getElementById("excelInput").click()'><i class="material-icons">file_upload</i>Excel読込</a></li></ul><a class="right sidenav-trigger" href="#" data-target="mobile-demo"><i class="material-icons">menu</i></a></div></nav><ul class="sidenav" id="mobile-demo"><li><a class="modal-trigger" href="#infoModal"><i class="material-icons">help_outline</i>使い方・履歴</a></li><li><a onclick="exportHTML()"><i class="material-icons">save</i>ツール保存</a></li><li class="divider"></li><li><a onclick="exportJSON()"><i class="material-icons">code</i>JSON出力</a></li><li><a onclick='document.getElementById("jsonInput").click()'><i class="material-icons">file_upload</i>JSON読込</a></li><li class="divider"></li><li><a onclick="exportExcel()"><i class="material-icons">grid_on</i>Excel出力</a></li><li><a onclick='document.getElementById("excelInput").click()'><i class="material-icons">file_upload</i>Excel読込</a></li><li class="divider"></li><li><a onclick="resetToSaved()"><i class="material-icons">restore</i>初期化</a></li></ul><input id="excelInput" type="file" onchange="importExcel(this)" accept=".xlsx, .xls" style="display:none"> <input id="jsonInput" type="file" onchange="importJSON(this)" accept=".json" style="display:none"><div class="container" style="margin-top:0;width:95%;max-width:1200px"><div class="sticky-header-wrapper" id="stickyHeaderContainer"><div class="filter-area"><div class="input-field filter-search"><i class="material-icons prefix">search</i> <input id="searchInput" type="text" oninput="applyFilter()"> <label for="searchInput">キーワード検索</label></div><div class="input-field"><select id="filterCategory" onchange="applyFilter()"><option value="" selected="selected">全ての分類</option></select> <label>分類で絞り込み</label></div><div class="input-field"><select id="filterStatus" onchange="applyFilter()"><option value="" selected="selected">全てのステータス</option><option value="未着手">未着手</option><option value="調査中">調査中</option><option value="対応中">対応中</option><option value="確認待ち">確認待ち</option><option value="処理済">処理済</option><option value="保留">保留</option><option value="完了">完了</option></select> <label>ステータスで絞り込み</label></div><a class="btn-flat waves-effect waves-teal btn-small" onclick="clearFilter()" style="margin-bottom:10px">解除</a> <span class="filter-msg" id="filterActiveMsg"><i class="material-icons tiny">info</i> 絞り込み中は並べ替えできません</span></div><div class="row" style="margin-bottom:0"><div class="col s12"><ul class="z-depth-1 tabs tabs-fixed-width"><li class="col s6 tab"><a class="active" href="#activeTab">未完了（優先順位）</a></li><li class="col s6 tab"><a href="#completedTab">完了済み</a></li></ul></div></div></div><div class="row"><div class="col s12 tab-content" id="activeTab"><div class="list-header"><div class="col-check"><label><input id="selectAllActive" type="checkbox" class="filled-in" onchange='toggleSelectAll("active",this.checked)'> <span></span></label></div><div class="col-priority">#</div><div class="col-category">分類</div><div class="col-name">タスク名称</div><div class="col-summary">概要</div><div class="col-status">ステータス</div><div class="col-date">リリース日</div><div class="col-action"></div></div><div class="z-depth-1" id="activeTaskList" style="background:#fff;border-radius:0 0 4px 4px"></div></div><div class="col s12 tab-content" id="completedTab"><div class="list-header"><div class="col-check"><label><input id="selectAllCompleted" type="checkbox" class="filled-in" onchange='toggleSelectAll("completed",this.checked)'> <span></span></label></div><div class="col-priority" style="color:#9e9e9e">-</div><div class="col-category">分類</div><div class="col-name">タスク名称</div><div class="col-summary">概要</div><div class="col-status">ステータス</div><div class="col-date">リリース日</div><div class="col-action"></div></div><div class="z-depth-1" id="completedTaskList" style="background:#fff;border-radius:0 0 4px 4px"></div></div></div></div><div class="fixed-action-btn" id="fabAdd"><a class="accent-3 btn-floating btn-large pink" onclick="createNewTask()"><i class="material-icons large">add</i></a></div><div class="bulk-action-bar" id="bulkActionBar"><div class="bulk-content"><span id="bulkSelectCount" style="font-weight:700;font-size:1.1rem;margin-right:15px">0 件選択</span><div style="display:flex;align-items:center;gap:5px;flex-wrap:wrap"><a class="btn-flat white-text" onclick="openBulkCategoryModal()"><i class="material-icons left">label</i>分類 </a><a class="btn-flat white-text" onclick="openBulkStatusModal()"><i class="material-icons left">donut_large</i>ステータス </a><a class="btn-flat white-text" onclick="openBulkDateModal()"><i class="material-icons left">event</i>日付 </a><a class="btn-flat white-text" onclick="openBulkTypeModal()"><i class="material-icons left">flag</i>区分 </a><a class="btn-flat white-text" onclick="bulkComplete()"><i class="material-icons left">done_all</i>完了 </a><a class="btn-flat white-text" onclick="bulkDelete()"><i class="material-icons left">delete</i>削除</a></div></div></div><div class="modal" id="bulkCategoryModal" style="max-width:400px"><div class="modal-content"><h5>一括分類変更</h5><p>選択したタスクの分類をまとめて変更します。<br><span class="grey-text text-darken-1" style="font-size:.9rem">※空欄で適用すると「分類なし」になります。</span></p><div class="input-field"><input id="bulkCategoryInput" type="text" placeholder="例: 開発, デザイン"> <label for="bulkCategoryInput" class="active">新しい分類名</label></div></div><div class="modal-footer"><a class="btn-flat waves-effect modal-close waves-grey" href="#!">キャンセル</a> <a class="btn-flat waves-effect modal-close waves-green" href="#!" onclick="applyBulkCategoryFromModal()">変更する</a></div></div><div class="modal" id="bulkStatusModal" style="max-width:400px"><div class="modal-content"><h5>一括ステータス変更</h5><p>選択したタスクのステータスをまとめて変更します。</p><div class="input-field"><select id="bulkStatusSelect"><option value="未着手">未着手</option><option value="調査中">調査中</option><option value="対応中">対応中</option><option value="確認待ち">確認待ち</option><option value="処理済">処理済</option><option value="保留">保留</option></select> <label>新しいステータス</label></div></div><div class="modal-footer"><a class="btn-flat waves-effect modal-close waves-grey" href="#!">キャンセル</a> <a class="btn-flat waves-effect modal-close waves-green" href="#!" onclick="applyBulkStatusFromModal()">変更する</a></div></div><div class="modal" id="bulkDateModal" style="max-width:400px"><div class="modal-content"><h5>一括日付変更</h5><p>選択したタスクの日付をまとめて変更します。</p><div class="input-field"><input id="bulkDateInputModal" type="date" placeholder=" "> <span class="helper-text">日付を選択してください</span></div></div><div class="modal-footer"><a class="btn-flat waves-effect modal-close left red-text waves-red" href="#!" onclick='applyBulkDateFromModal("")'>日付をクリア</a> <a class="btn-flat waves-effect modal-close waves-grey" href="#!">キャンセル</a> <a class="btn-flat waves-effect modal-close waves-green" href="#!" onclick='applyBulkDateFromModal(document.getElementById("bulkDateInputModal").value)'>変更する</a></div></div><div class="modal" id="bulkTypeModal" style="max-width:400px"><div class="modal-content"><h5>一括区分変更</h5><p>選択したタスクの日程区分をまとめて変更します。</p><div class="input-field"><select id="bulkTypeSelect"><option value="planned">予定</option><option value="confirmed">確定</option></select> <label>新しい区分</label></div></div><div class="modal-footer"><a class="btn-flat waves-effect modal-close waves-grey" href="#!">キャンセル</a> <a class="btn-flat waves-effect modal-close waves-green" href="#!" onclick="applyBulkTypeFromModal()">変更する</a></div></div><div class="modal" id="singleDateModal" style="max-width:400px"><div class="modal-content"><h5>日付変更</h5><p>タスクの日付を変更します。</p><div class="input-field"><input id="singleDateInputModal" type="date" placeholder=" "> <span class="helper-text">日付を選択してください</span></div></div><div class="modal-footer"><a class="btn-flat waves-effect modal-close left red-text waves-red" href="#!" onclick='applySingleDateFromModal("")'>日付をクリア</a> <a class="btn-flat waves-effect modal-close waves-grey" href="#!">キャンセル</a> <a class="btn-flat waves-effect modal-close waves-green" href="#!" onclick='applySingleDateFromModal(document.getElementById("singleDateInputModal").value)'>変更する</a></div></div><div class="modal modal-fixed-footer" id="taskModal"><div class="modal-content"><div class="modal-header-actions"><h5 id="modalTitle" style="margin:0">タスク詳細</h5><div><a class="btn-flat waves-effect waves-teal" onclick="duplicateCurrentTask()" title="このタスクを複製"><i class="material-icons left">content_copy</i>複製 </a><a class="btn-flat waves-effect waves-teal" onclick="resetCurrentTask()" title="このタスクを初期状態に戻す"><i class="material-icons left">restore</i>復元</a></div></div><div class="row"><form class="col s12"><input id="taskId" type="hidden"><div class="input-field col s12 m4"><i class="material-icons prefix">label</i> <input id="inputCategory" type="text" placeholder="例: 開発, デザイン" oninput="updateTaskValueDebounced()" class="validate"> <label for="inputCategory">分類</label></div><div class="input-field col s12 m8"><i class="material-icons prefix">title</i> <input id="inputName" type="text" oninput="updateTaskValueDebounced()" class="validate"> <label for="inputName">タスク名称</label></div><div class="input-field col s12"><i class="material-icons prefix">short_text</i> <textarea class="materialize-textarea" id="inputSummary" oninput="updateTaskValueDebounced()"></textarea> <label for="inputSummary">概要</label></div><div class="input-field col s12 m4"><i class="material-icons prefix">donut_large</i> <select id="inputStatus" onchange="updateTaskValue()"><option value="未着手">未着手</option><option value="調査中">調査中</option><option value="対応中">対応中</option><option value="確認待ち">確認待ち</option><option value="処理済">処理済</option><option value="保留">保留</option><option value="完了">完了</option></select> <label>ステータス</label></div><div class="input-field col s12 m4 date-input-wrapper"><i class="material-icons prefix">event</i> <input id="inputDate" type="text" placeholder="クリックして設定" onclick="openSingleDateModal(currentEditIndex,event)" readonly="readonly"> <label for="inputDate" class="active">リリース予定日</label> <i class="material-icons clear-date-btn" onclick="clearDate()" title="日付をクリア">close</i></div><div class="input-field col s12 m4"><select id="inputDateType" onchange="updateTaskValue()"><option value="planned">予定</option><option value="confirmed">確定</option></select> <label>日程区分</label></div><div class="input-field col s12"><i class="material-icons prefix">tune</i> <textarea class="materialize-textarea" id="inputAdjustment" oninput="updateTaskValueDebounced()" placeholder="調整状況・進捗詳細など"></textarea> <label for="inputAdjustment">調整状況</label></div><div class="col s12"><h6 class="grey-text text-darken-1" style="font-size:1rem;margin-top:20px"><i class="material-icons tiny">link</i> 関連リンク</h6><div class="link-row"><div class="input-field" style="flex:1;margin-bottom:0"><input id="inputLink1" type="text" placeholder="URL または ファイルパス" oninput="updateTaskValueDebounced()"> <label for="inputLink1" class="active">Link 1</label></div><i class="material-icons link-icon-btn" onclick='openLink("inputLink1")' title="開く">open_in_new</i> <i class="material-icons link-icon-btn" onclick='copyLink("inputLink1")' title="パスをコピー">content_copy</i></div><div class="link-row"><div class="input-field" style="flex:1;margin-bottom:0"><input id="inputLink2" type="text" placeholder="URL または ファイルパス" oninput="updateTaskValueDebounced()"> <label for="inputLink2" class="active">Link 2</label></div><i class="material-icons link-icon-btn" onclick='openLink("inputLink2")' title="開く">open_in_new</i> <i class="material-icons link-icon-btn" onclick='copyLink("inputLink2")' title="パスをコピー">content_copy</i></div><div class="link-row"><div class="input-field" style="flex:1;margin-bottom:0"><input id="inputLink3" type="text" placeholder="URL または ファイルパス" oninput="updateTaskValueDebounced()"> <label for="inputLink3" class="active">Link 3</label></div><i class="material-icons link-icon-btn" onclick='openLink("inputLink3")' title="開く">open_in_new</i> <i class="material-icons link-icon-btn" onclick='copyLink("inputLink3")' title="パスをコピー">content_copy</i></div><div class="link-row"><div class="input-field" style="flex:1;margin-bottom:0"><input id="inputLink4" type="text" placeholder="URL または ファイルパス" oninput="updateTaskValueDebounced()"> <label for="inputLink4" class="active">Link 4</label></div><i class="material-icons link-icon-btn" onclick='openLink("inputLink4")' title="開く">open_in_new</i> <i class="material-icons link-icon-btn" onclick='copyLink("inputLink4")' title="パスをコピー">content_copy</i></div><div class="link-row"><div class="input-field" style="flex:1;margin-bottom:0"><input id="inputLink5" type="text" placeholder="URL または ファイルパス" oninput="updateTaskValueDebounced()"> <label for="inputLink5" class="active">Link 5</label></div><i class="material-icons link-icon-btn" onclick='openLink("inputLink5")' title="開く">open_in_new</i> <i class="material-icons link-icon-btn" onclick='copyLink("inputLink5")' title="パスをコピー">content_copy</i></div></div></form></div></div><div class="modal-footer"><a class="btn-flat waves-effect modal-close left red-text waves-red" href="#!" onclick="deleteTask()">削除</a> <a class="btn-flat waves-effect modal-close waves-green" href="#!">閉じる</a></div></div><div class="modal" id="priorityModal" style="max-width:300px"><div class="modal-content"><h5>優先順位の変更</h5><p>移動先の番号を入力してください。</p><div class="input-field"><input id="priorityInputModal" type="number" placeholder=" " min="1"> <label for="priorityInputModal" class="active">新しい順位 (#)</label></div></div><div class="modal-footer"><a class="btn-flat waves-effect modal-close waves-grey" href="#!">キャンセル</a> <a class="btn-flat waves-effect modal-close waves-green" href="#!" onclick="applyPriorityFromModal()">移動する</a></div></div><div class="modal modal-fixed-footer" id="infoModal"><div class="modal-content"><h4>Information</h4><div class="row"><div class="col s12"><ul class="tabs"><li class="col s6 tab"><a class="active" href="#help">使い方</a></li><li class="col s6 tab"><a href="#changelog">変更履歴</a></li></ul></div><div class="col s12 info-section" id="help"><h6><i class="material-icons tiny">folder_open</i> プロジェクト管理</h6><p>本ツールは「ファイル名」ごとにデータを保存します。<br>ファイル名を変更する（例：<code>project_A.html</code>, <code>project_B.html</code>）ことで、 それぞれ別のタスクリストとして管理できます。</p><h6><i class="material-icons tiny">view_column</i> タブ機能</h6><p>タスクはステータスに応じて自動的に振り分けられます。<br><b>未完了（優先順位）:</b> 未着手、調査中、対応中、確認待ち、処理済、保留<br><b>完了済み:</b> 完了（最終更新日時順）</p><h6><i class="material-icons tiny">done_all</i> 一括操作</h6><p>各行のチェックボックスを選択すると、画面下部に一括操作バーが表示されます。<br>リストヘッダー（一番上）のチェックボックスをクリックすると、現在表示されているタスクを<b>「全選択 / 全解除」</b>できます。<br>ボタンをクリックすると<b>設定用ウィンドウ</b>が開き、選択したタスクの<b>「分類」「ステータス」「日付」「区分」</b>をまとめて変更できます。<br>（完了・削除は確認ダイアログのみ表示されます）</p><h6><i class="material-icons tiny">touch_app</i> 操作方法</h6><p><b>優先順位変更:</b> 「未完了」タブでドラッグ＆ドロップ。<br><span class="grey-text text-darken-2">※<b>「#番号」をクリック</b>して数値を直接入力し、順位を移動させることも可能です。</span><br><b>ステータス変更:</b> ステータスラベルをクリックすると切り替わります（完了を除く）。<br><b>リリース日変更:</b> 日付をクリックで変更、右横の「×」で削除できます。<br>未設定時はアイコン（<i class="material-icons tiny grey-text">event_note</i>）をクリックして設定します。<br><b>区分変更:</b> 「確定/予定」バッジをクリックすると切り替わります。<br><b>完了にする:</b> 各行右端のチェックボタン（<i class="material-icons tiny">check_circle</i>）を押すと、「完了」ステータスになり「完了済み」タブへ移動します。<br><b>削除の取り消し:</b> 削除した直後、画面下部に表示される<b>「元に戻す」ボタン</b>を押すと、削除を取り消せます。</p><h6><i class="material-icons tiny">label</i> カテゴリ・区分</h6><p><b>カテゴリ:</b> 自動的にパステルカラーで色分けされます。<br>入力時には、<b>過去に入力したカテゴリが候補として表示</b>されます。<br><b>日程区分:</b> リリース日が「確定」か「予定」かを表示します。</p><h6><i class="material-icons tiny">notification_important</i> 期限アラート</h6><p>未完了タスクのリリース予定日に応じて色が変化します。<br><span class="red-text font-bold">赤色太字:</span> 期限切れ<br><span class="font-bold orange-text text-darken-3">オレンジ太字:</span> 3日以内</p><h6><i class="material-icons tiny">content_copy</i> 複製機能</h6><p>詳細画面右上の「複製」ボタンを押すと、タスクをコピーして新規作成できます。<br>類似のタスクを登録する際に便利です。</p><h6><i class="material-icons tiny">filter_list</i> 検索・絞り込み機能</h6><p>キーワード検索：タスク名、概要、分類などに含まれる文字で検索できます。<br><b>検索にヒットした文字はハイライト（黄色）表示されます。</b><br>フィルター：分類やステータスで絞り込みが可能です。<br>※絞り込み中はドラッグ＆ドロップによる並べ替えが無効になります。</p><h6><i class="material-icons tiny">save</i> データの保存 (Save Tool)</h6><p>「Save Tool」で現在のタスクデータを含んだHTMLファイルを保存できます。<br>ファイル名には自動的に現在の日時が付与されます。</p><h6><i class="material-icons tiny">settings_backup_restore</i> JSONバックアップ</h6><p>ヘッダーの「JSON」メニューから選択します。<br><b>JSON保存:</b> タスクデータをJSONファイルとして保存します。<br><b>JSON読込:</b> JSONファイルを読み込み、データを復元します。<br>※ツールのバージョンアップ時にデータを移行する際に便利です。</p><h6><i class="material-icons tiny">file_upload</i> Excel連携</h6><p>ヘッダーの「Excel」メニューから選択します。<br><b>Excel出力:</b> 現在のリストをExcelファイルとして保存できます。<br><b>Excel読込:</b> Excelファイルを読み込むことができます。<br>※エクスポート時、完了タスクはリストの末尾に出力されます（優先順位番号なし）。<br>※インポート時のExcel列名は「分類」「タスク名」「概要」「ステータス」「リリース日」「日程区分」「調整状況」「Link1」〜「Link5」等に対応しています。</p><h6><i class="material-icons tiny">restore</i> Reset (初期化)</h6><p>右上の「Reset」ボタンを押すと、すべてのデータをファイルを開いた時の状態に戻します。<br>詳細画面内の「復元」ボタンは、そのタスクのみを初期状態に戻します。</p><h6><i class="material-icons tiny">security</i> セキュリティとデータ管理・免責事項</h6><p>本ツールは、入力されたタスク情報を<b>インターネット上のサーバーへ送信・保存することは一切ありません。</b><br>すべてのデータは、お使いのブラウザ内部（ローカルストレージ）および保存したHTMLファイル内にのみ記録される、機密性の高い設計となっております。<br><br><b>【免責事項】</b><br>ただし、本ツールの使用によって生じた、いかなる損害やトラブル（データの消失・漏洩・予期せぬ動作等）についても、開発者は一切の責任を負いかねます。<br>ご利用はご自身の責任においてお願いいたします。</p><h6><i class="material-icons tiny">contact_support</i> 問い合わせ先</h6><p>不具合報告や機能追加の要望は、以下のGitHubリポジトリまでお願いいたします。<br><a target="_blank" href="https://github.com/rn15h13ak1/task_manager" style="word-break:break-all">https://github.com/rn15h13ak1/task_manager</a></p></div><div class="col s12 info-section" id="changelog"><ul class="collection"><li class="collection-item"><span class="changelog-date">v2.31</span> ヘルプ（使い方）の記載内容を最新の機能（優先順位の直接入力、検索ハイライト、Undo、カテゴリ候補など）に合わせて更新</li><li class="collection-item"><span class="changelog-date">v2.30</span> Minify時にデータ読み込みロジックが削除されてしまう問題を修正（savedDataをwindowオブジェクトへ移行）</li><li class="collection-item"><span class="changelog-date">v2.29</span> HTML保存機能（Save Tool）がMinify（圧縮）後に動作しなくなる不具合を修正</li><li class="collection-item"><span class="changelog-date">v2.28</span> 【パフォーマンス改善】描画処理の最適化（一括レンダリング）と文字入力時の処理遅延（Debounce）を導入し、動作を軽量化。Excelライブラリを軽量版に変更。</li><li class="collection-item"><span class="changelog-date">v2.27</span> タスクの新規作成・編集時、過去に入力した「分類（カテゴリ）」が入力候補として表示される機能を追加</li><li class="collection-item"><span class="changelog-date">v2.26</span> エンプティステート表示、検索キーワードのハイライト、削除時の「元に戻す(Undo)」機能を追加</li><li class="collection-item"><span class="changelog-date">v2.25</span> ExcelおよびJSONエクスポート時のファイル名も、HTML保存と同様に「現在のファイル名＋タイムスタンプ」になるよう統一</li><li class="collection-item"><span class="changelog-date">v2.24</span> ナビゲーションバーのデザインを刷新。「JSON」「Excel」メニューをドロップダウン形式に統合</li><li class="collection-item"><span class="changelog-date">v2.23</span> 優先順位（#番号）をクリックして、数値を直接入力して並び順を変更できる機能を追加</li><li class="collection-item"><span class="changelog-date">v2.22</span> バッジ（ステータス・分類・区分）の配色を、白文字の視認性が高い濃い色調に変更</li><li class="collection-item"><span class="changelog-date">v2.21</span> HTML保存時のファイル名を、固定の「TaskManager」から「現在開いているファイル名」を引き継ぐように変更</li><li class="collection-item"><span class="changelog-date">v2.20</span> 画面スクロール時に「検索・フィルター」および「リストのヘッダー（項目名）」を画面上部に固定表示するように改善</li><li class="collection-item"><span class="changelog-date">v2.19</span> 一括操作（ステータス、分類、区分）の入力方式をすべて専用モーダルに統一し、UIの一貫性を向上</li><li class="collection-item"><span class="changelog-date">v2.18</span> 日付変更機能を全般的にモーダル入力方式へ変更（ブラウザ互換性と操作性の向上）</li><li class="collection-item"><span class="changelog-date">v2.17</span> 一括日付変更機能を復活（安定動作のため専用モーダル入力方式を採用）</li><li class="collection-item"><span class="changelog-date">v2.16</span> 一括操作機能の強化：選択したタスクの「分類」をまとめて変更する機能を追加</li><li class="collection-item"><span class="changelog-date">v2.15</span> UI改善：フォントサイズやバッジの大きさを統一し、全体的な見た目を調整</li><li class="collection-item"><span class="changelog-date">v2.14.1</span> 一括リリース日変更機能を削除（ブラウザ互換性の問題のため）</li><li class="collection-item"><span class="changelog-date">v2.14</span> 一括操作機能の強化：選択したタスクのステータス、日付、日程区分をまとめて変更可能に</li><li class="collection-item"><span class="changelog-date">v2.13.1</span> タスク並べ替え時に優先順位が更新されず、以降の操作ができなくなる不具合を修正</li><li class="collection-item"><span class="changelog-date">v2.13</span> 一覧ヘッダーのチェックボックスで、表示中のタスクを「全選択/全解除」できる機能を追加</li><li class="collection-item"><span class="changelog-date">v2.12</span> 内部構造の改善：CSS・JavaScriptファイルを機能ごとに分割して管理するように変更</li><li class="collection-item"><span class="changelog-date">v2.11</span> 一覧画面上で「リリース日」と「日程区分（確定/予定）」を直接変更できるように改善（未設定時はアイコン表示、削除ボタンの追加）</li><li class="collection-item"><span class="changelog-date">v2.10</span> タスク並べ替え時に優先順位番号が即座に反映されない不具合を修正</li><li class="collection-item"><span class="changelog-date">v2.9</span> タスク複製時、リストの先頭ではなく複製元の直下に追加するよう改善</li><li class="collection-item"><span class="changelog-date">v2.8</span> ファイル名によるデータ保存先の分離（マルチプロジェクト対応）</li><li class="collection-item"><span class="changelog-date">v2.7</span> リンク数を5つに拡張</li><li class="collection-item"><span class="changelog-date">v2.6</span> デザイン改善：バッジ形状をカプセル型に統一、パステルカラー対応</li><li class="collection-item"><span class="changelog-date">v2.5</span> リリース日の「確定/予定」区分を追加</li><li class="collection-item"><span class="changelog-date">v2.4</span> JSON形式での完全バックアップ・復元機能を追加</li><li class="collection-item"><span class="changelog-date">v2.3</span> カテゴリの自動色分け（バッジ）機能を追加</li><li class="collection-item"><span class="changelog-date">v2.2</span> 一括操作機能（まとめて完了・削除）を追加</li><li class="collection-item"><span class="changelog-date">v2.1</span> 期限アラート（赤・オレンジ表示）を追加</li><li class="collection-item"><span class="changelog-date">v2.0</span> 未完了/完了タブの実装、データ管理ロジックの刷新</li><li class="collection-item"><span class="changelog-date">v1.12</span> ステータスに「調査中」「処理済」を追加</li><li class="collection-item"><span class="changelog-date">v1.11</span> 一覧でのステータスクイック変更機能を追加</li><li class="collection-item"><span class="changelog-date">v1.10</span> タスクの複製機能を追加</li><li class="collection-item"><span class="changelog-date">v1.9</span> フリーワード検索機能を追加</li><li class="collection-item"><span class="changelog-date">v1.8</span> 編集終了時に該当タスクを強調表示する機能を追加</li><li class="collection-item"><span class="changelog-date">v1.7</span> Excelインポート時の改行コード処理を完全修正（二重改行対策）</li><li class="collection-item"><span class="changelog-date">v1.6</span> Excelインポート時の改行重複バグを修正</li><li class="collection-item"><span class="changelog-date">v1.5</span> 分類項目の追加、分類・ステータスによるフィルター機能追加</li><li class="collection-item"><span class="changelog-date">v1.4</span> Excelインポート時の日付変換処理を改善（シリアル値対応）</li><li class="collection-item"><span class="changelog-date">v1.3</span> ヘルプ画面のセキュリティ記述に免責事項を追加</li><li class="collection-item"><span class="changelog-date">v1.2</span> Help画面にセキュリティに関する説明を追加</li><li class="collection-item"><span class="changelog-date">v1.1</span> Help画面に問い合わせ先を追加</li><li class="collection-item"><span class="changelog-date">v1.0</span> 初版リリース（基本機能、Excel連携、HTML保存機能など）</li></ul></div></div></div><div class="modal-footer"><a class="btn-flat waves-effect modal-close waves-green" href="#!">閉じる</a></div></div><script src="https://code.jquery.com/jquery-3.6.0.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.mini.min.js"></script><script>function getStorageKey(){let e=window.location.pathname.split("/").pop();return e||(e="default"),"myTasks_"+e}function getBaseFileName(){let e="TaskManager";try{const t=window.location.pathname.split("/").pop();if(t){let n=decodeURIComponent(t);n=n.replace(/\.[^/.]+$/,""),n&&(e=n)}}catch(e){console.error("FileName get error:",e)}return e}function escapeHtml(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}let deletedTask=null,deletedTaskIndex=-1;function highlightText(e){if(!e)return"";if(!searchKeyword)return e;const t=searchKeyword.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`(${t})`,"gi");return e.replace(n,'<span class="search-highlight">$1</span>')}function normalizeText(e){if(!e)return"";return String(e).split(/\r\n|\n|\r/).join("\n").trim()}function getCategoryColor(e){const t=["#e65100","#00838f","#4527a0","#ad1457","#2e7d32","#ef6c00","#1565c0","#6a1b9a"];let n=0;for(let t=0;t<e.length;t++)n=e.charCodeAt(t)+((n<<5)-n);return t[Math.abs(n%t.length)]}function formatExcelDate(e){if(!e)return"";if("number"==typeof e){const t=new Date(Math.round(86400*(e-25569)*1e3));return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}const t=new Date(e);if(!isNaN(t.getTime())){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}return e}function debounce(e,t){let n;return function(...a){const s=this;clearTimeout(n),n=setTimeout(()=>{e.apply(s,a)},t)}}window.undoDelete=function(){deletedTask&&(deletedTaskIndex>=0&&deletedTaskIndex<=tasks.length?tasks.splice(deletedTaskIndex,0,deletedTask):tasks.push(deletedTask),saveTasks(),renderTasks(),M.toast({html:"元に戻しました"}),deletedTask=null,deletedTaskIndex=-1,M.Toast.dismissAll())},window.savedData=null;let tasks=[];const STATUS_CYCLE=["未着手","調査中","対応中","確認待ち","処理済","保留"],COMPLETED_STATUSES=["完了"];function loadTasks(){try{if(window.savedData&&Array.isArray(window.savedData)&&window.savedData.length>0)tasks=JSON.parse(JSON.stringify(window.savedData)),tasks=JSON.parse(JSON.stringify(savedData)),tasks.forEach(e=>{void 0===e.selected&&(e.selected=!1),void 0===e.dateType&&(e.dateType="planned"),void 0===e.link4&&(e.link4=""),void 0===e.link5&&(e.link5="")}),saveTasks();else{const e=localStorage.getItem(getStorageKey());e?(tasks=JSON.parse(e),tasks.forEach(e=>{void 0===e.selected&&(e.selected=!1),void 0===e.dateType&&(e.dateType="planned"),void 0===e.link4&&(e.link4=""),void 0===e.link5&&(e.link5="")})):tasks=[{id:Date.now(),category:"未分類",name:"サンプルタスク",summary:"ファイル名を変更すると、別のデータとして保存されます。",adjustment:"",status:"未着手",date:"",dateType:"planned",link1:"",link2:"",link3:"",link4:"",link5:"",lastUpdated:(new Date).toISOString(),selected:!1}]}}catch(e){console.error("Load Error:",e),tasks=[]}"function"==typeof renderTasks&&renderTasks()}function saveTasks(){localStorage.setItem(getStorageKey(),JSON.stringify(tasks))}function exportHTML(){const e=document.documentElement.cloneNode(!0);e.querySelectorAll(".sidenav-overlay, .drag-target, .toast, .material-tooltip, .hiddendiv").forEach(e=>e.remove()),e.querySelectorAll(".select-wrapper").forEach(e=>{const t=e.querySelector("select");t&&(t.removeAttribute("tabindex"),t.classList.remove("initialized"),Array.from(t.options).forEach(e=>e.removeAttribute("selected")),e.parentNode.replaceChild(t,e))}),e.querySelectorAll("label.active").forEach(e=>e.classList.remove("active")),e.querySelectorAll("input, textarea").forEach(e=>{e.classList.remove("valid","invalid"),"TEXTAREA"===e.tagName?e.innerHTML="":e.setAttribute("value","")});const t=e.querySelector("#activeTaskList");t&&(t.innerHTML="",t.removeAttribute("style"));const n=e.querySelector("#completedTaskList");n&&(n.innerHTML="",n.removeAttribute("style"));const a=e.querySelector("#filterCategory");a&&(a.value="");const s=e.querySelector("#filterStatus");s&&(s.value="");const l=e.querySelector("#searchInput");l&&l.setAttribute("value","");const o=JSON.parse(JSON.stringify(tasks));o.forEach(e=>e.selected=!1);let i=e.outerHTML,r=`window.savedData = ${0===o.length?"null":JSON.stringify(o)};`;i=i.replace(/window\.savedData\s*=\s*[\s\S]*?;/,r);const d=getBaseFileName(),c=new Blob([i],{type:"text/html"}),u=URL.createObjectURL(c),m=document.createElement("a");m.href=u;const k=(new Date).toISOString().slice(0,19).replace(/[-:]/g,"").replace("T","_");m.download=`${d}_${k}.html`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(u),M.toast({html:"保存しました"})}function exportExcel(){if(0===tasks.length)return void M.toast({html:"データがありません"});const e=tasks.filter(e=>!COMPLETED_STATUSES.includes(e.status)),t=tasks.filter(e=>COMPLETED_STATUSES.includes(e.status));t.sort((e,t)=>{const n=e.lastUpdated||"";return(t.lastUpdated||"").localeCompare(n)});const n=[...e,...t].map((e,t)=>{const n=COMPLETED_STATUSES.includes(e.status),a="confirmed"===e.dateType?"確定":"予定";return{"優先順位":n?"-":t+1,"分類":e.category,"タスク名":e.name,"概要":e.summary,"調整状況":e.adjustment,"ステータス":e.status,"リリース日":e.date,"日程区分":a,Link1:e.link1,Link2:e.link2,Link3:e.link3,Link4:e.link4,Link5:e.link5,"最終更新":e.lastUpdated}});let a=1;n.forEach(e=>{"-"!==e.優先順位&&(e.優先順位=a++)});const s=XLSX.utils.json_to_sheet(n),l=XLSX.utils.book_new();XLSX.utils.book_append_sheet(l,s,"Tasks");const o=getBaseFileName(),i=(new Date).toISOString().slice(0,19).replace(/[-:]/g,"").replace("T","_");XLSX.writeFile(l,`${o}_${i}.xlsx`)}function exportJSON(){if(0===tasks.length)return void M.toast({html:"データがありません"});const e=JSON.parse(JSON.stringify(tasks));e.forEach(e=>e.selected=!1);const t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),n=document.createElement("a");n.setAttribute("href",t);const a=getBaseFileName(),s=(new Date).toISOString().slice(0,19).replace(/[-:]/g,"").replace("T","_");n.setAttribute("download",`${a}_${s}.json`),document.body.appendChild(n),n.click(),n.remove()}function importJSON(e){const t=e.files[0];if(!t)return;const n=new FileReader;n.onload=function(t){try{const e=JSON.parse(t.target.result);Array.isArray(e)?confirm("現在のタスクを上書きして、JSONデータを読み込みますか？")&&(tasks=e,tasks.forEach(e=>{void 0===e.selected&&(e.selected=!1),void 0===e.dateType&&(e.dateType="planned"),void 0===e.link4&&(e.link4=""),void 0===e.link5&&(e.link5="")}),saveTasks(),"function"==typeof renderTasks&&renderTasks(),M.toast({html:"JSON読み込み完了"})):M.toast({html:"無効なJSONフォーマットです"})}catch(e){console.error(e),M.toast({html:"読み込みエラー"})}e.value=""},n.readAsText(t)}function importExcel(e){const t=e.files[0];if(!t)return;const n=new FileReader;n.onload=function(t){const n=new Uint8Array(t.target.result),a=XLSX.read(n,{type:"array"}),s=XLSX.utils.sheet_to_json(a.Sheets[a.SheetNames[0]]);s.length>0&&(confirm("上書きしますか？")&&(tasks=[]),s.forEach(e=>{let t="planned";"確定"===e["日程区分"]&&(t="confirmed"),tasks.push({id:Date.now()+Math.random(),category:normalizeText(e["分類"]||e.category||""),name:normalizeText(e["タスク名"]||e.name||"名称未設定"),summary:normalizeText(e["概要"]||e.summary||""),adjustment:normalizeText(e["調整状況"]||e.adjustment||""),status:e["ステータス"]||"未着手",date:formatExcelDate(e["リリース日"]||e.date||""),dateType:t,link1:normalizeText(e.Link1||""),link2:normalizeText(e.Link2||""),link3:normalizeText(e.Link3||""),link4:normalizeText(e.Link4||""),link5:normalizeText(e.Link5||""),lastUpdated:e["最終更新"]||(new Date).toISOString(),selected:!1})}),saveTasks(),"function"==typeof renderTasks&&renderTasks(),M.toast({html:"完了"})),e.value=""},n.readAsArrayBuffer(t)}let currentEditIndex=-1,sortableInstance=null,filterCategory="",filterStatus="",searchKeyword="";function renderTasks(){populateFilterOptions();const e=document.getElementById("activeTaskList"),t=document.getElementById("completedTaskList");if(e.innerHTML="",t.innerHTML="",0===tasks.length)return e.innerHTML='\n                <div class="empty-state">\n                    <i class="material-icons">inbox</i>\n                    <p>タスクがありません。<br>右下の「+」ボタンから追加するか、Excel/JSONをインポートしてください。</p>\n                </div>\n            ',document.getElementById("bulkActionBar").style.display="none",void(document.getElementById("fabAdd").style.display="block");const n=""!==filterCategory||""!==filterStatus||""!==searchKeyword,a=document.getElementById("filterActiveMsg");sortableInstance&&sortableInstance.option("disabled",n),a&&(a.style.display=n?"inline-block":"none");const s=tasks.filter(e=>e.selected).length,l=document.getElementById("bulkActionBar"),o=document.getElementById("fabAdd");s>0?(l.style.display="block",document.getElementById("bulkSelectCount").innerText=`${s} 件選択中`,o&&(o.style.display="none")):(l.style.display="none",o&&(o.style.display="block"));let i=0;const r=[];tasks.forEach((e,t)=>{COMPLETED_STATUSES.includes(e.status)||checkFilter(e)&&(r.push(renderRow(e,t,!1)),i++)}),e.innerHTML=r.join(""),n&&0===i&&(e.innerHTML='\n                <div class="empty-state">\n                    <i class="material-icons">search_off</i>\n                    <p>条件に一致するタスクが見つかりませんでした。</p>\n                </div>\n            ');const d=tasks.map((e,t)=>({task:e,index:t})).filter(e=>COMPLETED_STATUSES.includes(e.task.status));d.sort((e,t)=>{const n=e.task.lastUpdated||"";return(t.task.lastUpdated||"").localeCompare(n)});const c=[];d.forEach(e=>{checkFilter(e.task)&&c.push(renderRow(e.task,e.index,!0))}),t.innerHTML=c.join(""),updateActivePriorities(),updateSelectAllCheckbox("active"),updateSelectAllCheckbox("completed")}function updateSelectAllCheckbox(e){const t=document.getElementById("active"===e?"selectAllActive":"selectAllCompleted");if(!t)return;const n=tasks.filter(t=>{const n=COMPLETED_STATUSES.includes(t.status);return("active"===e&&!n||"completed"===e&&n)&&checkFilter(t)});if(0===n.length)t.checked=!1,t.disabled=!0;else{t.disabled=!1;const e=n.every(e=>e.selected);t.checked=e}}function checkFilter(e){if(filterCategory&&e.category!==filterCategory)return!1;if(filterStatus&&e.status!==filterStatus)return!1;if(searchKeyword){if(-1===((e.name||"")+(e.summary||"")+(e.category||"")+(e.adjustment||"")).toLowerCase().indexOf(searchKeyword))return!1}return!0}function renderRow(e,t,n){let a="#546e7a";"対応中"!==e.status&&"調査中"!==e.status||(a="#0277bd"),"完了"!==e.status&&"処理済"!==e.status||(a="#2e7d32"),"確認待ち"===e.status&&(a="#ef6c00");const s=n?"task-row completed-task":"task-row";let l="";l=n?'<div class="col-priority" style="color: #9e9e9e; cursor: default;">-</div>':`<div class="col-priority" onclick="openPriorityModal(${t}, event)" title="クリックして順位を変更">#${t+1}</div>`;const o=n?"":`<i class="material-icons btn-complete" onclick="completeTask(${t}, event)" title="完了にする">check_circle</i>`,i=n?"":`onclick="cycleStatus(${t}, event)"`,r=n?"status-chip badge-common":"status-chip badge-common hover-hand";let d="";if(!n&&e.date){const t=new Date;t.setHours(0,0,0,0);const n=e.date.split("-");if(3===n.length){const e=new Date(n[0],n[1]-1,n[2])-t,a=Math.ceil(e/864e5);a<0?d="red-text text-accent-4 font-bold":a>=0&&a<=3&&(d="orange-text text-darken-3 font-bold")}}const c=e.selected?"checked":"";let u="";if(e.date){const n="confirmed"===e.dateType?"確定":"予定",a=`<br><span class="date-type-badge ${"confirmed"===e.dateType?"type-confirmed":"type-planned"}" onclick="toggleDateType(${t}, event)" title="クリックして切替">${n}</span>`;u=`\n      <div class="date-input-container">\n        <input \n          type="text" \n          class="inline-date-input ${d}" \n          value="${e.date}" \n          readonly\n          onclick="openSingleDateModal(${t}, event)"\n          style="cursor: pointer;"\n        />\n        <i class="material-icons date-clear-btn" \n           onclick="updateTaskDate(${t}, ''); event.stopPropagation();"\n           title="日付を削除">close</i>\n      </div>\n      ${a}\n    `}else u=`\n      <div class="date-placeholder" title="クリックして日付を設定" onclick="openSingleDateModal(${t}, event)">\n         <i class="material-icons grey-text text-lighten-2">event_note</i>\n      </div>\n    `;return`\n            <div class="${s}" data-id="${e.id}" onclick="openEditModal(${t})">\n                <div class="col-check" onclick="event.stopPropagation()">\n                    <label>\n                        <input type="checkbox" class="filled-in" ${c} onchange="toggleSelect(${t}, event)" />\n                        <span></span>\n                    </label>\n                </div>\n                ${l} <div class="col-category multiline-truncate">${renderCategoryBadge(e.category)}</div>\n                \n                <div class="col-name multiline-truncate" title="${escapeHtml(e.name)}">\n                    ${highlightText(escapeHtml(e.name))}\n                </div>\n                <div class="col-summary multiline-truncate">\n                    ${highlightText(escapeHtml(e.summary||"-"))}\n                </div>\n                \n                <div class="col-status">\n                    <span class="${r}" style="background-color: ${a};" ${i}>${escapeHtml(e.status)}</span>\n                </div>\n                <div class="col-date">\n                    ${u}\n                </div>\n                <div class="col-action">${o}</div>\n            </div>\n          `}function updateActivePriorities(){document.querySelectorAll("#activeTaskList .task-row").forEach((e,t)=>{e.querySelector(".col-priority").innerText=`#${t+1}`})}function renderCategoryBadge(e){if(!e)return"-";return`<span class="category-badge badge-common" style="background-color: ${getCategoryColor(e)};">${escapeHtml(e)}</span>`}function highlightTaskById(e){const t=document.querySelector(`.task-row[data-id="${e}"]`);t&&(t.classList.add("highlight-task"),setTimeout(()=>{t.classList.remove("highlight-task")},1500))}function populateFilterOptions(){const e=document.getElementById("filterCategory"),t=e.value;for(;e.options.length>1;)e.remove(1);const n=new Set;tasks.forEach(e=>{e.category&&n.add(e.category)});const a=Array.from(n).sort();a.forEach(t=>{const n=document.createElement("option");n.value=t,n.text=t,e.add(n)}),e.value=t,M.FormSelect.init(e);const s=document.getElementById("categoryListSuggestions");s&&(s.innerHTML="",a.forEach(e=>{const t=document.createElement("option");t.value=e,s.appendChild(t)}))}function applyFilter(){filterCategory=document.getElementById("filterCategory").value,filterStatus=document.getElementById("filterStatus").value,searchKeyword=document.getElementById("searchInput").value.toLowerCase().trim(),renderTasks()}function clearFilter(){document.getElementById("filterCategory").value="",document.getElementById("filterStatus").value="",document.getElementById("searchInput").value="",filterCategory="",filterStatus="",searchKeyword="",M.FormSelect.init(document.querySelectorAll("select")),renderTasks()}let singleDateTargetIndex=-1;function handleSortEnd(){const e=document.getElementById("activeTaskList"),t=Array.from(e.children).map(e=>e.getAttribute("data-id")),n=[];t.forEach(e=>{const t=tasks.find(t=>String(t.id)===String(e));t&&n.push(t)});const a=tasks.filter(e=>COMPLETED_STATUSES.includes(e.status)),s=new Set(t),l=tasks.filter(e=>!COMPLETED_STATUSES.includes(e.status)&&!s.has(String(e.id)));tasks=[...n,...l,...a],saveTasks(),"function"==typeof updateActivePriorities&&updateActivePriorities()}function createNewTask(){if(filterCategory||filterStatus||searchKeyword){if(!confirm("フィルターを解除して新規作成しますか？"))return;clearFilter()}const e={id:Date.now(),category:"",name:"",summary:"",adjustment:"",status:"未着手",date:"",dateType:"planned",link1:"",link2:"",link3:"",link4:"",link5:"",lastUpdated:(new Date).toISOString(),selected:!1};tasks.unshift(e),saveTasks(),renderTasks(),openEditModal(0)}function duplicateCurrentTask(){if(-1===currentEditIndex)return;const e=tasks[currentEditIndex],t=JSON.parse(JSON.stringify(e));t.id=Date.now()+Math.random(),t.lastUpdated=(new Date).toISOString(),t.selected=!1,tasks.splice(currentEditIndex+1,0,t),saveTasks(),renderTasks(),openEditModal(currentEditIndex+1),M.toast({html:"タスクを複製しました"})}function openEditModal(e){if(e<0||e>=tasks.length)return;currentEditIndex=e;const t=tasks[e];document.getElementById("taskId").value=t.id,document.getElementById("inputCategory").value=t.category||"",document.getElementById("inputName").value=t.name,document.getElementById("inputSummary").value=t.summary,document.getElementById("inputAdjustment").value=t.adjustment||"";document.getElementById("inputDate").value=t.date;const n=document.getElementById("inputDateType");n.value=t.dateType||"planned",document.getElementById("inputLink1").value=t.link1||"",document.getElementById("inputLink2").value=t.link2||"",document.getElementById("inputLink3").value=t.link3||"",document.getElementById("inputLink4").value=t.link4||"",document.getElementById("inputLink5").value=t.link5||"",document.getElementById("inputStatus").value=t.status,M.updateTextFields(),M.textareaAutoResize(document.getElementById("inputSummary")),M.textareaAutoResize(document.getElementById("inputAdjustment"));const a=document.getElementById("inputStatus");a.value=t.status,M.FormSelect.init(a),M.FormSelect.init(n);const s=document.getElementById("taskModal");let l=M.Modal.getInstance(s);l||(l=M.Modal.init(s)),l.open()}function updateTaskValue(){-1!==currentEditIndex&&(tasks[currentEditIndex].category=document.getElementById("inputCategory").value,tasks[currentEditIndex].name=document.getElementById("inputName").value,tasks[currentEditIndex].summary=document.getElementById("inputSummary").value,tasks[currentEditIndex].status=document.getElementById("inputStatus").value,tasks[currentEditIndex].date=document.getElementById("inputDate").value,tasks[currentEditIndex].dateType=document.getElementById("inputDateType").value,tasks[currentEditIndex].adjustment=document.getElementById("inputAdjustment").value,tasks[currentEditIndex].link1=document.getElementById("inputLink1").value,tasks[currentEditIndex].link2=document.getElementById("inputLink2").value,tasks[currentEditIndex].link3=document.getElementById("inputLink3").value,tasks[currentEditIndex].link4=document.getElementById("inputLink4").value,tasks[currentEditIndex].link5=document.getElementById("inputLink5").value,tasks[currentEditIndex].lastUpdated=(new Date).toISOString(),saveTasks(),renderTasks())}document.addEventListener("DOMContentLoaded",function(){M.Modal.init(document.querySelectorAll(".modal"),{onCloseEnd:function(){if(-1!==currentEditIndex){const e=tasks[currentEditIndex];e&&highlightTaskById(e.id),currentEditIndex=-1}}}),M.FormSelect.init(document.querySelectorAll("select")),M.Sidenav.init(document.querySelectorAll(".sidenav")),M.Tabs.init(document.querySelectorAll(".tabs")),M.Dropdown.init(document.querySelectorAll(".dropdown-trigger"),{constrainWidth:!1,coverTrigger:!1}),loadTasks();const e=document.getElementById("activeTaskList");sortableInstance=Sortable.create(e,{animation:150,ghostClass:"sortable-ghost",delay:0,touchStartThreshold:3,onEnd:function(e){handleSortEnd()}}),window.addEventListener("resize",adjustStickyHeaderPosition),setTimeout(adjustStickyHeaderPosition,100)});const updateTaskValueDebounced=debounce(()=>{updateTaskValue()},500);function clearDate(){document.getElementById("inputDate").value="",updateTaskValue()}function deleteTask(){if(-1!==currentEditIndex&&confirm("本当に削除しますか？")){deletedTask=tasks[currentEditIndex],deletedTaskIndex=currentEditIndex,tasks.splice(currentEditIndex,1),saveTasks(),renderTasks();const e=M.Modal.getInstance(document.getElementById("taskModal"));currentEditIndex=-1,e.close();const t='<span>削除しました</span><button class="btn-flat toast-action-btn" onclick="undoDelete()">元に戻す</button>';M.toast({html:t,displayLength:5e3})}}function resetToSaved(){confirm("現在の編集内容を破棄して、ファイル保存時の状態に戻しますか？")&&(savedData&&Array.isArray(savedData)&&savedData.length>0?(tasks=JSON.parse(JSON.stringify(savedData)),tasks.forEach(e=>{void 0===e.selected&&(e.selected=!1)})):tasks=[{id:Date.now(),category:"未分類",name:"サンプルタスク",summary:"...",adjustment:"",status:"未着手",date:"",dateType:"planned",link1:"",link2:"",link3:"",link4:"",link5:"",lastUpdated:(new Date).toISOString(),selected:!1}],saveTasks(),renderTasks(),M.toast({html:"保存時の状態に戻しました"}))}function resetCurrentTask(){if(-1===currentEditIndex)return;if(!confirm("このタスクの内容をファイル保存時の状態に戻しますか？"))return;const e=tasks[currentEditIndex].id;let t=null;savedData&&Array.isArray(savedData)&&(t=savedData.find(t=>t.id===e)),t?(tasks[currentEditIndex]=JSON.parse(JSON.stringify(t)),M.toast({html:"タスクを復元しました"})):(tasks[currentEditIndex]={id:e,category:"",name:"",summary:"",adjustment:"",status:"未着手",date:"",dateType:"planned",link1:"",link2:"",link3:"",link4:"",link5:"",lastUpdated:(new Date).toISOString(),selected:!1},M.toast({html:"初期状態（空）に戻しました"})),openEditModal(currentEditIndex),saveTasks(),renderTasks()}function openLink(e){const t=document.getElementById(e).value;t?window.open(t,"_blank"):M.toast({html:"リンクが入力されていません"})}function copyLink(e){const t=document.getElementById(e).value;t?navigator.clipboard.writeText(t).then(()=>M.toast({html:"コピーしました"}),()=>M.toast({html:"失敗しました"})):M.toast({html:"リンクが入力されていません"})}function toggleSelect(e,t){t.stopPropagation(),e<0||e>=tasks.length||(tasks[e].selected=!tasks[e].selected,saveTasks(),renderTasks())}function toggleSelectAll(e,t){tasks.forEach(n=>{const a=COMPLETED_STATUSES.includes(n.status);("active"===e&&!a||"completed"===e&&a)&&checkFilter(n)&&(n.selected=t)}),saveTasks(),renderTasks()}function bulkComplete(){const e=tasks.filter(e=>e.selected&&!COMPLETED_STATUSES.includes(e.status));if(0!==e.length){if(confirm(`${e.length}件のタスクを「完了」にしますか？`)){const t=(new Date).toISOString();e.forEach(e=>{e.status="完了",e.lastUpdated=t,e.selected=!1}),saveTasks(),renderTasks(),M.toast({html:"一括完了しました"})}}else M.toast({html:"完了にする未完了タスクが選択されていません"})}function bulkDelete(){const e=tasks.filter(e=>e.selected);0!==e.length&&confirm(`選択された ${e.length}件のタスクを削除しますか？\nこの操作は取り消せません。`)&&(tasks=tasks.filter(e=>!e.selected),saveTasks(),renderTasks(),M.toast({html:"一括削除しました"}))}function openBulkCategoryModal(){if(0===tasks.filter(e=>e.selected).length)return void M.toast({html:"タスクが選択されていません"});document.getElementById("bulkCategoryInput").value="",M.updateTextFields();const e=document.getElementById("bulkCategoryModal");M.Modal.getInstance(e).open()}function applyBulkCategoryFromModal(){const e=document.getElementById("bulkCategoryInput").value,t=tasks.filter(e=>e.selected);if(0===t.length)return;const n=e?`「${e}」`:"「分類なし」";setTimeout(()=>{if(confirm(`選択された ${t.length}件の分類を${n}に変更しますか？`)){const n=(new Date).toISOString();t.forEach(t=>{t.category=e,t.lastUpdated=n,t.selected=!1}),saveTasks(),renderTasks(),M.toast({html:"分類を一括変更しました"})}},100)}function openBulkStatusModal(){if(0===tasks.filter(e=>e.selected).length)return void M.toast({html:"タスクが選択されていません"});const e=document.getElementById("bulkStatusSelect");e.value="未着手",M.FormSelect.init(e);const t=document.getElementById("bulkStatusModal");M.Modal.getInstance(t).open()}function applyBulkStatusFromModal(){const e=document.getElementById("bulkStatusSelect").value,t=tasks.filter(e=>e.selected);0!==t.length&&setTimeout(()=>{if(confirm(`選択された ${t.length}件のステータスを「${e}」に変更しますか？`)){const n=(new Date).toISOString();t.forEach(t=>{t.status=e,t.lastUpdated=n,t.selected=!1}),saveTasks(),renderTasks(),M.toast({html:"ステータスを一括変更しました"})}},100)}function openBulkTypeModal(){if(0===tasks.filter(e=>e.selected).length)return void M.toast({html:"タスクが選択されていません"});const e=document.getElementById("bulkTypeSelect");e.value="planned",M.FormSelect.init(e);const t=document.getElementById("bulkTypeModal");M.Modal.getInstance(t).open()}function applyBulkTypeFromModal(){const e=document.getElementById("bulkTypeSelect").value,t=tasks.filter(e=>e.selected);if(0===t.length)return;const n="confirmed"===e?"確定":"予定";setTimeout(()=>{if(confirm(`選択された ${t.length}件の日程区分を「${n}」に変更しますか？`)){const n=(new Date).toISOString();t.forEach(t=>{t.dateType=e,t.lastUpdated=n,t.selected=!1}),saveTasks(),renderTasks(),M.toast({html:"区分を一括変更しました"})}},100)}function openBulkDateModal(){if(0===tasks.filter(e=>e.selected).length)return void M.toast({html:"タスクが選択されていません"});document.getElementById("bulkDateInputModal").value="";const e=document.getElementById("bulkDateModal");M.Modal.getInstance(e).open()}function applyBulkDateFromModal(e){const t=tasks.filter(e=>e.selected);if(0===t.length)return;const n=e?`「${e}」に変更`:"クリア";setTimeout(()=>{if(confirm(`選択された ${t.length}件の日付を${n}しますか？`)){const n=(new Date).toISOString();t.forEach(t=>{t.date=e,t.lastUpdated=n,t.selected=!1}),saveTasks(),renderTasks(),M.toast({html:"日付を一括変更しました"})}},100)}function openSingleDateModal(e,t){if(t&&t.stopPropagation(),e<0||e>=tasks.length)return;singleDateTargetIndex=e,document.getElementById("singleDateInputModal").value=tasks[e].date||"";const n=document.getElementById("singleDateModal");M.Modal.getInstance(n).open()}function applySingleDateFromModal(e){if(-1===singleDateTargetIndex)return;const t=tasks[singleDateTargetIndex];t.date=e,t.lastUpdated=(new Date).toISOString(),saveTasks(),renderTasks(),currentEditIndex===singleDateTargetIndex&&(document.getElementById("inputDate").value=e),singleDateTargetIndex=-1,M.toast({html:"日付を変更しました"})}function cycleStatus(e,t){if(t.stopPropagation(),e<0||e>=tasks.length)return;const n=tasks[e].status;let a=STATUS_CYCLE.indexOf(n)+1;a>=STATUS_CYCLE.length&&(a=0),-1===STATUS_CYCLE.indexOf(n)&&(a=0);const s=STATUS_CYCLE[a];tasks[e].status=s,tasks[e].lastUpdated=(new Date).toISOString(),saveTasks(),renderTasks(),M.toast({html:`ステータスを「${s}」に変更しました`,displayLength:1500})}function completeTask(e,t){t.stopPropagation(),e<0||e>=tasks.length||confirm("このタスクを「完了」にしてよろしいですか？\n（完了済みタブに移動します）")&&(tasks[e].status="完了",tasks[e].lastUpdated=(new Date).toISOString(),saveTasks(),renderTasks(),M.toast({html:"タスクを完了しました"}))}function toggleDateType(e,t){if(t.stopPropagation(),e<0||e>=tasks.length)return;const n=tasks[e];n.dateType="confirmed"===n.dateType?"planned":"confirmed",n.lastUpdated=(new Date).toISOString(),saveTasks(),renderTasks();const a="confirmed"===n.dateType?"確定":"予定";M.toast({html:`日程区分を「${a}」に変更しました`})}function updateTaskDate(e,t){e<0||e>=tasks.length||(tasks[e].date=t,tasks[e].lastUpdated=(new Date).toISOString(),saveTasks(),renderTasks())}function adjustStickyHeaderPosition(){const e=document.getElementById("stickyHeaderContainer");if(!e)return;const t=e.offsetHeight;document.querySelectorAll(".list-header").forEach(e=>{e.style.top=t+"px"})}window.updateTaskValueDebounced=updateTaskValueDebounced;let priorityTargetIndex=-1,currentPriorityNum=-1;function openPriorityModal(e,t){if(t&&t.stopPropagation(),COMPLETED_STATUSES.includes(tasks[e].status))return;priorityTargetIndex=e;const n=tasks.filter(e=>!COMPLETED_STATUSES.includes(e.status)),a=tasks[e].id;currentPriorityNum=n.findIndex(e=>e.id===a)+1,document.getElementById("priorityInputModal").value=currentPriorityNum,M.updateTextFields();const s=document.getElementById("priorityModal");M.Modal.getInstance(s).open()}function applyPriorityFromModal(){const e=document.getElementById("priorityInputModal").value;if(!e||-1===priorityTargetIndex)return;const t=parseInt(e,10);if(isNaN(t)||t<1)return;if(t===currentPriorityNum)return;const n=tasks[priorityTargetIndex],a=tasks.filter(e=>!COMPLETED_STATUSES.includes(e.status)).length;let s=t-1;s>=a&&(s=a-1);const l=tasks.filter(e=>!COMPLETED_STATUSES.includes(e.status)),o=tasks.filter(e=>COMPLETED_STATUSES.includes(e.status)),i=l.findIndex(e=>e.id===n.id);l.splice(i,1),l.splice(s,0,n),tasks=[...l,...o],n.lastUpdated=(new Date).toISOString(),saveTasks(),renderTasks(),M.toast({html:`優先順位を #${t} に変更しました`}),priorityTargetIndex=-1}</script></body></html>